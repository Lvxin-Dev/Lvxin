<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigation Components</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../static/CSS/stylee.css">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next@21.6.10/i18next.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next-http-backend@1.3.2/i18nextHttpBackend.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/i18next-browser-languagedetector@6.1.3/i18nextBrowserLanguageDetector.min.js"></script>
    <script src="../static/JS/i18n.js"></script>
    <style>
        /* Color Scheme */
        :root {
            /* Light Mode */
            --primary: #4361ee;
            --secondary: #3f37c9;
            --danger: #f72585;
            --success: #00B894;
            --warning: #FDCB6E;
            --background: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
            --border: #e0e0e0;
            --card-bg: #f8f9fa;
            --nav-bg: rgba(255, 255, 255, 0.95);
            --sidebar-bg: linear-gradient(180deg, var(--primary), var(--secondary));
            --gradient-start: #4A90E2;
            --gradient-end: #6C5CE7;
            --sidebar-width: 240px;
        }

        [data-theme="dark"] {
            /* Dark Mode */
            --primary: #6366F1;
            --primary-hover: #4F46E5;
            --secondary: #8B5CF6;
            --secondary-hover: #7C3AED;
            --accent: #FBBF24;
            --background: #0F172A;
            --text-primary: #F9FAFB;
            --text-secondary: #9CA3AF;
            --border: #374151;
            --border-light: #1F2937;
            --nav-bg: rgba(17, 24, 39, 0.98);
            --card-bg: #1F2937;
            --hover-bg: #1F2937;
            --sidebar-bg: linear-gradient(180deg, var(--primary), var(--secondary));
        }

        /* Base Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            transition: all 0.2s ease;
        }

        body {
            background: var(--background);
            color: var(--text-primary);
            line-height: 1.4;
            font-size: 14px;
            display: flex;
            min-height: 100vh;
            padding-top: 64px;
        }

        /* Navbar styles */
        .navbar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.8rem 2rem;
            background: var(--nav-bg);
            backdrop-filter: blur(8px);
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1000;
            box-shadow: 0 1px 5px rgba(0, 0, 0, 0.1);
            border-bottom: 1px solid var(--border);
        }

        .logo img {
            height: 40px;
            transition: transform 0.3s ease;
            filter: drop-shadow(0 3px 6px rgba(74, 144, 226, 0.3));
            border-radius: 8px;
            background: linear-gradient(135deg, var(--gradient-start), var(--gradient-end));
            padding: 3px;
        }

        .logo:hover img {
            transform: scale(1.05) rotate(4deg);
            filter: drop-shadow(0 4px 8px rgba(74, 144, 226, 0.5));
        }

        .nav-links {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }

        .nav-links a {
            color: var(--text-primary);
            text-decoration: none;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .nav-links a:hover {
            color: var(--primary);
            background: rgba(74, 144, 226, 0.1);
            border-radius: 5px;
            padding: 0.3rem 0.5rem;
        }

        .actions {
            display: flex;
            gap: 0.8rem;
            align-items: center;
        }

        .icon-btn {
            background: none;
            border: none;
            cursor: pointer;
            padding: 0.4rem;
            color: var(--text-primary);
            font-size: 1rem;
            border-radius: 50%;
        }

        .icon-btn:hover {
            color: var(--primary);
            background: rgba(74, 144, 226, 0.1);
            transform: scale(1.05);
        }

        .profile-component {
            display: flex;
            align-items: center;
            gap: 0.6rem;
            padding: 0.4rem 0.8rem;
            border-radius: 20px;
            background: rgba(74, 144, 226, 0.1);
            border: 1.5px solid var(--primary);
            text-decoration: none;
            font-size: 0.85rem;
        }

        .profile-component:hover {
            background: rgba(74, 144, 226, 0.2);
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(74, 144, 226, 0.1);
        }

        .profile-image {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            object-fit: cover;
            border: 1.5px solid white;
            box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);
        }

        .profile-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.85rem;
        }
        
        /* Sidebar Styles */
        .sidebar {
            width: var(--sidebar-width);
            background: var(--sidebar-bg);
            color: white;
            position: fixed;
            top: 64px;
            left: 0;
            height: calc(100vh - 64px);
            padding: 1rem 0;
            overflow-y: auto;
            box-shadow: 1px 0 6px rgba(0, 0, 0, 0.1);
            z-index: 999;
        }

        [data-theme="dark"] .sidebar {
            background: linear-gradient(180deg, var(--primary), var(--secondary));
        }
        

        
        .nav-title {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.8px;
            padding: 10px 15px 5px;
            font-weight: 600;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 3px 6px;
            border-radius: 6px;
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            font-size: 0.85rem;
        }
        
        .nav-item i {
            margin-right: 8px;
            font-size: 1rem;
            width: 18px;
            text-align: center;
        }
        
        .nav-item:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            transform: translateX(3px);
        }
        
        .nav-item.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        [data-theme="dark"] .nav-item.active {
            background: rgba(255, 255, 255, 0.15);
        }
        
        /* Contract Sections */
        .contract-section {
            padding: 8px 16px;
            margin: 4px 0;
            color: rgba(255, 255, 255, 0.9);
            border-left: 3px solid rgba(255, 255, 255, 0.3);
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .contract-section:hover {
            background: rgba(255, 255, 255, 0.1);
            border-left-color: white;
        }
        
        .contract-section.active {
            background: rgba(255, 255, 255, 0.2);
            border-left-color: var(--danger);
            font-weight: 600;
        }
        
        /* Main Content Styles */
        .main-content {
            margin-left: var(--sidebar-width);
            padding: 1.5rem 2rem;
            flex: 1;
            margin-top: 64px;
            transition: margin-left 0.2s ease;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }

        .tab-group {
            display: flex;
            gap: 10px;
        }

        .tab-btn {
            padding: 10px 20px;
            background: var(--background);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            color: var(--text-primary);
        }

        .tab-btn:hover {
            background: var(--border);
        }

        .tab-btn.active {
            background: var(--primary);
            color: white;
        }

        .tab-btn i {
            font-size: 16px;
        }

        /* Action Buttons */
        .tab-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.85rem;
        }

        .action-btn.primary {
            background: var(--primary);
            color: white;
            border: none;
        }

        .action-btn.secondary {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .action-btn.secondary:hover {
            background: rgba(67, 97, 238, 0.1);
        }

        .action-btn i {
            font-size: 14px;
        }

        /* Tab Content */
        .tab-content {
            display: none;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            min-height: 300px;
            border: 1px solid var(--border);
        }

        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        /* Risk level indicators */
        .risk-high {
            color: #f72585;
            font-weight: bold;
        }
        
        .risk-medium {
            color: #f8961e;
            font-weight: bold;
        }
        
        .risk-normal {
            color: #4cc9f0;
            font-weight: bold;
        }
        
        .risk-low {
            color: #38b000;
            font-weight: bold;
        }
        
        /* Content sections */
        .content-section {
            margin-bottom: 20px;
            padding: 15px;
            background: var(--background);
            border-radius: 5px;
        }
        
        pre {
            white-space: pre-wrap;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 5px;
            border: 1px solid var(--border);
        }

        /* Rule sequence */
        .rule-sequence {
            display: inline-block;
            background: rgba(67, 97, 238, 0.1);
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 8px;
            color: var(--primary);
        }

        /* Risk Page Styles */
        .risk-container {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
        }
        
        .risk-chart-container {
            flex: 1;
            min-width: 300px;
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }
        
        .risk-details-container {
            flex: 1;
            min-width: 300px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .risk-clause-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }
        
        .risk-analysis-card {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            border: 1px solid var(--border);
        }
        
        .risk-brief {
            margin-top: 15px;
            padding: 15px;
            background: var(--background);
            border-radius: 8px;
            display: none;
        }
        
        .risk-brief.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        
        .summarize-btn {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
            margin-top: 10px;
        }
        
        .summarize-btn:hover {
            background: var(--secondary);
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        /* Suggestions Tab Styles */
        .suggestions-container {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            max-width: 900px;
            margin: 0 auto;
        }
        
        .modification-item {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
            margin-bottom: 30px;
            overflow: hidden;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border: 1px solid var(--border);
        }
        
        .modification-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.12);
        }
        
        .modification-header {
            background: var(--background);
            padding: 15px 20px;
            border-bottom: 1px solid var(--border);
        }
        
        .modification-header h3 {
            margin: 0;
            color: var(--text-primary);
            font-size: 1.1em;
            display: flex;
            align-items: center;
        }
        
        .action-tag {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.8em;
            margin-left: 10px;
        }
        
        .content-comparison {
            display: flex;
            flex-direction: column;
            padding: 0;
        }
        
        .original-content, .suggested-content {
            padding: 20px;
            position: relative;
        }
        
        .original-content {
            background: #fff5f5;
            border-left: 4px solid #ff6b6b;
        }
        
        .suggested-content {
            background: #f5fff7;
            border-left: 4px solid #51cf66;
        }
        
        .content-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .content-icon {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }
        
        .original-icon {
            background: #ff6b6b;
            color: white;
        }
        
        .suggested-icon {
            background: #51cf66;
            color: white;
        }
        
        .content-header h4 {
            margin: 0;
            font-size: 1em;
            color: var(--text-primary);
        }
        
        pre {
            white-space: pre-wrap;
            margin: 0;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 0.9em;
            line-height: 1.5;
            background: var(--card-bg);
            padding: 15px;
            border-radius: 4px;
            border: 1px solid var(--border);
        }

        /* Overall Section */
        #suggestions-tab {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            color: var(--text-primary);
            padding: 20px;
        }

        /* Title */
        .modifications-title {
            font-size: 1.8rem;
            color: var(--primary);
            margin-bottom: 20px;
            border-bottom: 2px solid var(--border);
            padding-bottom: 8px;
        }

        /* Rule sequence tag */
        .rule-sequence {
            background-color: rgba(67, 97, 238, 0.1);
            color: var(--primary);
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 0.9rem;
            margin-left: 10px;
        }

        /* Modification Group Box */
        .modification-item {
            background-color: var(--card-bg);
            border: 1px solid var(--border);
            border-radius: 12px;
            margin-bottom: 24px;
            padding: 16px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        /* Headings */
        .modification-heading {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        .modification-action {
            font-size: 0.95rem;
            color: var(--text-secondary);
            margin-bottom: 12px;
        }

        /* Content Boxes */
        .contract-block {
            border-radius: 10px;
            padding: 16px;
            margin-bottom: 12px;
            overflow-x: auto;
        }

        .contract-block h4.block-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-primary);
        }

        /* Original Content Styling */
        .original-block {
            background-color: #fef2f2; /* light red */
            border: 1px solid #fca5a5;
        }

        /* Suggested Content Styling */
        .suggested-block {
            background-color: #ecfdf5; /* light green */
            border: 1px solid #6ee7b7;
        }

        /* Code Block (pre) Styling */
        .contract-block pre {
            font-family: 'Fira Code', monospace;
            font-size: 0.95rem;
            white-space: pre-wrap;
            word-wrap: break-word;
            margin: 0;
            line-height: 1.5;
            background: var(--background);
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            .main-content {
                margin-left: 0;
                padding-top: 100px;
            }
            .sidebar {
                width: 100%;
                height: auto;
                position: static;
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
                padding: 0.8rem;
            }

        }

        @media (max-width: 768px) {
            .navbar {
                flex-direction: column;
                padding: 0.8rem;
                gap: 0.8rem;
            }
            .nav-links {
                width: 100%;
                justify-content: center;
                flex-wrap: wrap;
                gap: 0.8rem;
                display: none;
            }
            .actions {
                width: 100%;
                justify-content: center;
            }
            .main-content {
                padding: 1rem;
                padding-top: 120px;
            }
            .profile-name {
                display: none;
            }
            .profile-component {
                padding: 0.4rem;
            }
            .tab-nav {
                flex-direction: column;
                gap: 10px;
            }
            
            .tab-group {
                width: 100%;
                overflow-x: auto;
                padding-bottom: 5px;
            }
            
            .tab-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }

        @media (max-width: 480px) {
            .tab-btn {
                padding: 8px 12px;
                font-size: 0.85rem;
            }
            .action-btn {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <nav class="navbar">
        <div class="logo">
            <a href="welcome_page">
                <img src="../static/images/logo.jpg" alt="Company Logo">
            </a>
        </div>

        <div class="nav-links">
            <a href="subscriptions" class="en-content" data-i18n="header.pricing">Pricing</a>
            <a href="aboutus" class="en-content" data-i18n="header.about_us">About Us</a>
            <a href="helpcenter" class="en-content" data-i18n="header.help_center">Help Center</a>
        </div>
        <div class="actions">
            <select id="language-selector" class="language-selector" aria-label="Language selector" style="background-color: var(--card-bg); color: var(--text-primary); border: 1px solid var(--border); border-radius: 5px; padding: 0.3rem 0.5rem; margin-right: 0.5rem;">
                <option value="en">English</option>
                <option value="zh">中文</option>
            </select>
            <button id="themeToggle" class="icon-btn">
                <i class="fas fa-moon"></i>
            </button>
            <!-- Elfsight website translator -->
            <script src="https://static.elfsight.com/platform/platform.js" async></script>
            <div class="elfsight-app-fce75b10-069c-41d5-bca0-09c33e812801" data-elfsight-app-lazy></div>

            <a href="profile" class="profile-component">
                <img src="../static/images/profile.jpeg" class="profile-image" alt="Profile Image">
                <span class="profile-name">{{name}}</span>
            </a>
        </div>
    </nav>

    <!-- Sidebar -->
    <nav class="sidebar" id="sidebar">
        <div class="nav-section">
            <h3 class="nav-title" data-i18n="sidebar.team_database">Team Database</h3>
            <a href="mydash" class="nav-item"> <i class="fas fa-bar-chart"></i> <span data-i18n="sidebar.upload_contract_cn">上传合同</span> </a>
            <a href="upload_contract" class="nav-item"><i class="fas fa-file-upload"></i> <span data-i18n="sidebar.upload_contract">Upload Contract</span></a>
            <a href="history" class="nav-item"><i class="fas fa-history"></i> <span data-i18n="sidebar.analysis_history">Analysis History</span></a>
            <a href="Analytics_Dashboard" class="nav-item active"><i class="fas fa-file-contract"></i> <span data-i18n="sidebar.document_analysis">Document Analysis</span></a>
        </div>
        <div class="nav-section">
            <h3 class="nav-title" data-i18n="sidebar.account">Account</h3>
            <a href="profile" class="nav-item"><i class="fas fa-user"></i> <span data-i18n="sidebar.user_profile">User Profile</span></a>
            <a href="subscriptions" class="nav-item"><i class="fas fa-star"></i> <span data-i18n="sidebar.subscriptions">Subscriptions</span></a>
        </div>
        <div class="nav-section">
            <h3 class="nav-title" data-i18n="sidebar.support">Support</h3>
            <a href="contactus" class="nav-item"><i class="fas fa-envelope"></i> <span data-i18n="sidebar.contact_us">Contact Us</span></a>
            <a href="helpcenter" class="nav-item"><i class="fas fa-question-circle"></i> <span data-i18n="sidebar.faqs">FAQs</span></a>
            <a href="aboutus" class="nav-item"><i class="fas fa-info-circle"></i> <span data-i18n="sidebar.about_us">About Us</span></a>
            <a href="whats-new" class="nav-item"><i class="fas fa-info-circle"></i> <span data-i18n="sidebar.whats_new">What's New</span></a>
        </div>
    </nav>

    <!-- Main Content Area -->
    <main class="main-content">
        <!-- Tab Navigation -->
        <div class="tab-nav">
            <div class="tab-group">
                <button class="tab-btn active" data-tab="overview">
                    <i class="fas fa-chart-pie"></i> <span data-i18n="tabs.overview">Overview</span>
                </button>
                <button class="tab-btn" data-tab="risks">
                    <i class="fas fa-exclamation-triangle"></i> <span data-i18n="tabs.risks">Risks</span>
                </button>
                <button class="tab-btn" data-tab="suggestions">
                    <i class="fas fa-lightbulb"></i> <span data-i18n="tabs.suggestions">Suggestions</span>
                </button>
                <button class="tab-btn" onclick="window.location.href='document'">
                    <i class="fas fa-file-alt"></i> <span data-i18n="tabs.document">Document</span>
                </button>
            </div>
            
            <div class="tab-actions">
                <button class="action-btn primary">
                    <i class="fas fa-file-pdf"></i> <span data-i18n="actions.export_to_pdf">Export to PDF</span>
                </button>
                <button class="action-btn secondary">
                    <i class="fas fa-share-alt"></i> <span data-i18n="actions.share_report">Share Report</span>
                </button>
                <button class="action-btn secondary">
                    <i class="fas fa-calendar-alt"></i> <span data-i18n="actions.schedule_meeting">Schedule Meeting</span>
                </button>
            </div>
        </div>

        <!-- Tab Contents -->
        <div id="overview-tab" class="overview-container tab-content active"></div>

        <div id="risks-tab" class="tab-content">
            <div class="risk-container">
                <div class="risk-chart-container">
                    <h2 data-i18n="risks.risk_distribution">Risk Distribution <span class="rule-sequence">1.1</span></h2>
                    <div class="chart-container">
                        <canvas id="riskChart"></canvas>
                    </div>
                </div>
                
                <div class="risk-details-container">
                    <div class="risk-clause-card">
                        <h2 data-i18n="risks.risk_clause">Risk Clause</h2>
                        <p data-i18n="risks.qualification_not_specified">Contract party qualifications not clearly specified</p>
                    </div>
                    
                    <div class="risk-analysis-card">
                        <h2 data-i18n="risks.risk_analysis">Risk Analysis</h2>
                        <p data-i18n="risks.analysis_details">Since the contract text does not clearly specify the specific identity information of Party A and Party B, such as whether a natural person has full civil capacity or whether a legal person is legally established and validly existing, nor does it mention that both parties need to show each other proof of identity and existence and qualifications before signing the contract, there may be legal risks during contract execution.</p>
                        <button class="summarize-btn" data-i18n="risks.summarize_risk">Summarize Risk</button>
                        <div class="risk-brief">
                            <h3 data-i18n="risks.risk_brief">Risk Brief</h3>
                            <p data-i18n="risks.brief_details">The contract lacks clear identification requirements for both parties, which could lead to legal issues regarding the validity and enforceability of the contract.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="suggestions-tab" class="tab-content">
            <h2 data-i18n="suggestions.page_title">Suggestions Page</h2>
            <p data-i18n="suggestions.page_description">This is the suggestions page showing recommended amendments.</p>
            <p data-i18n="suggestions.api_content">It will display original content alongside suggested modifications from the API.</p>
        </div>

       <div id="document-tab" class="tab-content">
            <div style="text-align: center; padding: 40px;">
                <button id="viewDocumentBtn" class="nav-button" 
                        style="padding: 12px 24px; background: var(--primary); color: white; border: none; border-radius: 5px; cursor: pointer; font-size: 1rem;">
                    <i class="fas fa-file-alt"></i> <span data-i18n="document.view_full_document">View Full Document</span>
                </button>
            </div>
        </div>

        <script>
            // Tab functionality
            document.querySelectorAll('.tab-btn').forEach(button => {
                button.addEventListener('click', () => {
                    document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                    button.classList.add('active');
                    
                    const tabId = button.getAttribute('data-tab');
                    document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
                    document.getElementById(`${tabId}-tab`).classList.add('active');
                });
            });

            // Risk Chart
            const ctx = document.getElementById('riskChart').getContext('2d');
            const riskChart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: ['High Risk', 'Medium Risk', 'Normal Risk', 'Low Risk'],
                    datasets: [{
                        data: [5, 10, 15, 20],
                        backgroundColor: ['#f72585', '#f8961e', '#4cc9f0', '#38b000'],
                        borderColor: '#fff',
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'top',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(tooltipItem) {
                                    return `${tooltipItem.label}: ${tooltipItem.raw}`;
                                }
                            }
                        }
                    }
                }
            });
        </script>
    </main>

    <!-- <script src="../static/js/script.js"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    
    // Theme Toggle Functionality (same as original)
    const themeToggle = document.getElementById('themeToggle');
    let isDarkMode = localStorage.getItem('darkMode') === 'true';

    function toggleTheme() {
        isDarkMode = !isDarkMode;
        document.body.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
        themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';
        localStorage.setItem('darkMode', isDarkMode);
    }

    // Initialize theme
    themeToggle.addEventListener('click', toggleTheme);
    document.body.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
    themeToggle.innerHTML = isDarkMode ? '<i class="fas fa-sun"></i>' : '<i class="fas fa-moon"></i>';

    // Sample data for the risk chart
    const riskData = {
        labels: ['High Risk', 'Medium Risk', 'Low Risk', 'Normal'],
        datasets: [{
            data: [0, 0, 0, 0], // Initialize with zeros
            backgroundColor: [
                '#f72585', // High risk color
                '#f8961e', // Medium risk color
                '#38b000', // Low risk color
                '#4cc9f0'  // Normal risk color
            ],
            borderColor: [
                '#fff',
                '#fff',
                '#fff',
                '#fff'
            ],
            borderWidth: 1
        }]
    };

    // Chart configuration (same as original)
    const chartConfig = {
        type: 'doughnut',
        data: riskData,
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        generateLabels: function(chart) {
                            const original = Chart.overrides.doughnut.plugins.legend.labels.generateLabels(chart);
                            return original.map(label => {
                                if (label.text === 'High Risk') label.fillStyle = '#f72585';
                                else if (label.text === 'Medium Risk') label.fillStyle = '#f8961e';
                                else if (label.text === 'Low Risk') label.fillStyle = '#38b000';
                                else if (label.text === 'Normal') label.fillStyle = '#4cc9f0';
                                return label;
                            });
                        }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: function(context) {
                            const label = context.label || '';
                            const value = context.raw || 0;
                            const total = context.dataset.data.reduce((a, b) => a + b, 0);
                            const percentage = Math.round((value / total) * 100) || 0;
                            return `${label}: ${value} (${percentage}%)`;
                        }
                    }
                }
            },
            cutout: '70%',
        }
    };

    // Function to count risk levels from subRisks (same as original)
    function countRiskLevels(subRisks) {
        const counts = {
            high: 0,
            medium: 0,
            low: 0,
            normal: 0
        };

        subRisks.forEach(risk => {
            const level = (risk.riskLevel || '').toLowerCase();
            if (level.includes('high')) counts.high++;
            else if (level.includes('medium')) counts.medium++;
            else if (level.includes('low')) counts.low++;
            else counts.normal++;
        });

        return counts;
    }

    // Function to update chart colors based on risk level (same as original)
    function updateChartColors(riskLevel) {
        const colors = {
            high: '#f72585',
            medium: '#f8961e',
            low: '#38b000',
            normal: '#4cc9f0'
        };
        
        const level = riskLevel.toLowerCase();
        const color = colors[level] || colors['medium'];
        
        // Set all segments to the same color based on overall risk level
        riskData.datasets[0].backgroundColor = Array(4).fill(color);
    }

    // Function to create contract sections in sidebar
    function createContractSections(data) {
        console.log('Creating contract sections with data:', data);
        const teamDatabaseSection = document.querySelector('.nav-section:first-child');
        
        // Remove existing container if it exists
        const existingContainer = document.querySelector('.contract-sections-container');
        if (existingContainer) {
            existingContainer.remove();
        }
        
        // Create new container
        const contractSectionsContainer = document.createElement('div');
        contractSectionsContainer.className = 'nav-section contract-sections-container';

        const contractTitle = document.createElement('h3');
        contractTitle.className = 'nav-title';
        contractTitle.textContent = 'Contract Sections';
        contractSectionsContainer.appendChild(contractTitle);

        let hasSections = false;

        // Check if data is an array
        if (Array.isArray(data)) {
            data.forEach((item, index) => {
                if (item && item.Output && item.Output.result) {
                    const result = item.Output.result;
                    createSectionElement(result, contractSectionsContainer);
                    hasSections = true;
                } else if (item && item.ruleTitle) {
                    // Handle case where item is already a result object
                    createSectionElement(item, contractSectionsContainer);
                    hasSections = true;
                }
            });
        } 
        // Check if data is an object (but not an array)
        else if (typeof data === 'object' && data !== null) {
            // If it has Output.result, it's a single result
            if (data.Output && data.Output.result) {
                createSectionElement(data.Output.result, contractSectionsContainer);
                hasSections = true;
            } 
            // If it's an object with ruleTitle, it's already a result
            else if (data.ruleTitle) {
                createSectionElement(data, contractSectionsContainer);
                hasSections = true;
            } 
            // Handle object with multiple sections
            else {
                Object.entries(data).forEach(([key, value]) => {
                    if (value && typeof value === 'object') {
                        const items = Array.isArray(value) ? value : [value];
                        items.forEach(item => {
                            if (item && item.Output && item.Output.result) {
                                createSectionElement(item.Output.result, contractSectionsContainer);
                                hasSections = true;
                            } else if (item && item.ruleTitle) {
                                createSectionElement(item, contractSectionsContainer);
                                hasSections = true;
                            }
                        });
                    }
                });
            }
        }

        // Only add the container if we have sections
        if (hasSections) {
            teamDatabaseSection.insertAdjacentElement('afterend', contractSectionsContainer);
            
            // Activate the first section if any exists
            const firstContractSection = contractSectionsContainer.querySelector('.contract-section');
            if (firstContractSection) {
                firstContractSection.click();
            } else {
                console.error('No valid contract sections found in API response');
            }
        } else {
            console.error('No valid contract sections found in API response', data);
        }
    }
    
    // Helper function to create a section element
    function createSectionElement(result, container) {
        const contractSection = document.createElement('div');
        contractSection.className = 'contract-section';
        
        // Use ruleTitle or fall back to a default title
        const title = result.ruleTitle || 'Untitled Section';
        const sequence = result.ruleSequence ? ` <span class="rule-sequence">${result.ruleSequence}</span>` : '';
        
        contractSection.innerHTML = `${title}${sequence}`;
        contractSection.dataset.result = JSON.stringify(result);

        contractSection.addEventListener('click', function() {
            document.querySelectorAll('.contract-section').forEach(section => section.classList.remove('active'));
            this.classList.add('active');
            loadContractDetails(JSON.parse(this.dataset.result));
        });

        container.appendChild(contractSection);
    }
    

    function getRiskPositionAndColor(riskValue) {
        if (typeof riskValue === 'string') {
            riskValue = riskValue.toLowerCase();
            if (riskValue === 'medium') return { color: '#f8961e', position: '50%' };
            if (riskValue === 'high') return { color: '#f72585', position: '83.5%' };
            if (riskValue === 'normal') return { color: '#4cc9f0', position: '16.5%' };
            if (riskValue === 'low') return { color: '#38b000', position: '16.5%' };
        }
        if (typeof riskValue === 'number') {
            let percent = Math.min(Math.max((riskValue / 3) * 100, 0), 100);
            let color = '#38b000';
            if (percent < 33) color = '#38b000';
            else if (percent < 66) color = '#f8961e';
            else color = '#f72585';
            return { color, position: percent + '%' };
        }
        return { color: '#f8961e', position: '50%' };
    }

    // Function to load contract details into main content
    function loadContractDetails(result) {
        if (!result) {
            console.error('No result data provided to loadContractDetails');
            return;
        }

        // Clear all tab contents
        document.querySelectorAll('.tab-content').forEach(content => {
            content.classList.remove('active');
        });

        // Activate the overview tab
        document.querySelector('.tab-btn[data-tab="overview"]').click();

        const { color, position } = getRiskPositionAndColor(result.riskLevel);

        const overviewTab = document.getElementById('overview-tab');
        overviewTab.innerHTML = `
        <style>
            .overview-container {
                font-family: Arial, sans-serif;
                padding: 20px;
            }
            .overview-heading {
                font-size: 24px;
                font-weight: bold;
                text-align: center;
                margin-bottom: 20px;
            }
            .risk-bar-wrapper {
                position: relative;
                height: 30px;
                background: linear-gradient(to right, #38b000 33%, #f8961e 33% 66%, #f72585 66%);
                border-radius: 20px;
                margin: 10px auto;
                max-width: 600px;
            }
            .risk-marker {
                position: absolute;
                top: -5px;
                width: 16px;
                height: 16px;
                border-radius: 50%;
                border: 3px solid white;
                background-color: ${color};
                left: 0;
                transform: translateX(-50%);
                transition: left 0.5s ease-in-out;
            }
            .risk-labels {
                display: flex;
                justify-content: space-between;
                font-size: 14px;
                max-width: 600px;
                margin: 5px auto 20px;
            }
            .risk-level-text {
                text-align: center;
                font-weight: bold;
                font-size: 18px;
                margin-bottom: 25px;
            }
            .section-heading {
                font-size: 20px;
                font-weight: bold;
                text-align: center;
                margin-bottom: 15px;
                margin-top: 40px;
            }
            .info-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
                max-width: 900px;
                margin: auto;
            }
            .card {
                background: var(--card-bg);
                padding: 15px;
                border-radius: 12px;
                box-shadow: 0 1px 3px rgba(0,0,0,0.1);
                border: 1px solid var(--border);
            }
            .card h4 {
                margin-bottom: 8px;
                color: var(--text-secondary);
            }
            .risk-low {
                color: #38b000;
            }
            .risk-medium {
                color: #f8961e;
            }
            .risk-high {
                color: #f72585;
            }
            .risk-normal {
                color: #4cc9f0;
            }
        </style>

        <div class="overview-container">
            <div class="overview-heading" data-i18n="overview.risk_assessment">Risk Assessment</div>

            <div class="risk-bar-wrapper">
                <div class="risk-marker"></div>
            </div>

            <div class="risk-labels">
                <span data-i18n="overview.low">Low</span><span data-i18n="overview.medium">Medium</span><span data-i18n="overview.high">High</span>
            </div>

            <div class="risk-level-text risk-${result.riskLevel ? result.riskLevel.toLowerCase() : 'medium'}">
                ${result.riskLevel || 'Medium'} <span data-i18n="overview.risk">Risk</span> (${result.ruleSequence || '1.1'})
            </div>

            <div class="section-heading" data-i18n="overview.key_terms">Key Terms</div>

            <div class="info-grid">
                <div class="card">
                    <h4 data-i18n="overview.examination_result">Examination Result</h4>
                    <p>${result.examineResult || 'No examination result available'}</p>
                </div>
                <div class="card">
                    <h4 data-i18n="overview.rule_title">Rule Title</h4>
                    <p>${result.ruleTitle || 'No rule title available'}</p>
                </div>
                <div class="card">
                    <h4 data-i18n="overview.examination_brief">Examination Brief</h4>
                    <p>${result.examineBrief || 'No examination brief available'}</p>
                </div>
                <div class="card">
                    <h4 data-i18n="overview.rule_tag">Rule Tag</h4>
                    <p>${result.ruleTag || 'No rule tag available'}</p>
                </div>
            </div>
        </div>
        `;

        // Animate the risk marker to the correct position
        const riskMarker = overviewTab.querySelector('.risk-marker');
        if (riskMarker) {
            setTimeout(() => {
                riskMarker.style.left = position;
                riskMarker.style.backgroundColor = color;
            }, 50);
        }

        // Populate Risks Tab
        if (result.subRisks && result.subRisks.length > 0) {
            const risksTab = document.getElementById('risks-tab');
            
            // Count risk levels for the chart
            const riskCounts = countRiskLevels(result.subRisks);
            
            // Update chart data
            riskData.datasets[0].data = [
                riskCounts.high,
                riskCounts.medium,
                riskCounts.low,
                riskCounts.normal
            ];
            
            // Update chart colors based on main risk level
            updateChartColors(result.riskLevel);
            
            risksTab.innerHTML = `
                <div class="risk-container">
                    <div class="risk-chart-container">
                        <h2 data-i18n="risks.risk_distribution">Risk Distribution <span class="rule-sequence">${result.ruleSequence || '1.1'}</span></h2>
                        <div class="chart-container">
                            <canvas id="riskChart"></canvas>
                        </div>
                        <div class="risk-chart-summary">
                            <div class="risk-level-display risk-${result.riskLevel ? result.riskLevel.toLowerCase() : 'medium'}">
                                <i class="fas fa-exclamation-triangle"></i>
                                <span data-i18n="risks.overall_risk">Overall Risk</span>: ${result.riskLevel || 'Medium'}
                            </div>
                        </div>
                    </div>
                    
                    <div class="risk-details-container">
                        <div class="risk-clause-card">
                            <h2 data-i18n="risks.risk_clause">Risk Clause</h2>
                            <p>${result.subRisks[0].riskClause || 'General Risk'}</p>
                        </div>
                        
                        <div class="risk-analysis-card">
                            <h2 data-i18n="risks.risk_analysis">Risk Analysis</h2>
                            <p>${result.subRisks[0].riskExplain || 'No risk explanation available'}</p>
                            <button class="summarize-btn" data-i18n="risks.summarize_risk.hide" data-i18n-show="risks.summarize_risk.show">Summarize Risk</button>
                            <div class="risk-brief">
                                <h3 data-i18n="risks.risk_brief">Risk Brief</h3>
                                <p>${result.subRisks[0].riskBrief || 'No brief available'}</p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Initialize the chart with updated data
            const ctx = document.getElementById('riskChart').getContext('2d');
            new Chart(ctx, chartConfig);
            
            // Add event listener for summarize button
            document.querySelector('.summarize-btn')?.addEventListener('click', function() {
                const riskBrief = document.querySelector('.risk-brief');
                riskBrief.classList.toggle('show');
                this.textContent = riskBrief.classList.contains('show') ? 'Hide Summary' : 'Summarize Risk';
            });
        } else {
            // If no subRisks, show a message
            document.getElementById('risks-tab').innerHTML = `
                <div class="risk-container">
                    <div class="risk-chart-container">
                        <h2 data-i18n="risks.risk_distribution">Risk Distribution</h2>
                        <p data-i18n="risks.no_detail">No detailed risk information available</p>
                    </div>
                </div>
            `;
        }

        // Populate Suggestions Tab
        if (result.subRisks && result.subRisks.some(subRisk => subRisk.resultContent)) {
            const suggestionsTab = document.getElementById('suggestions-tab');
            suggestionsTab.innerHTML = `
                <h2 class="modifications-title" data-i18n="suggestions.suggested_modifications">Suggested Modifications <span class="rule-sequence">${result.ruleSequence || '1.1'}</span></h2>
                ${result.subRisks.filter(subRisk => subRisk.resultContent).map(subRisk => `
                    <div class="content-section modification-item">
                        <h3 class="modification-heading">${subRisk.riskClause || 'Modification'}</h3>
                        ${subRisk.resultType ? `<p class="modification-action"><strong data-i18n="suggestions.action">Action:</strong> ${subRisk.resultType}</p>` : ''}
                        <div class="contract-block original-block">
                            <h4 class="block-title">
                                <span style="color: black;" data-i18n="suggestions.original_content">Original Content</span>
                            </h4>
                            <pre>${subRisk.originalContent || 'No original content available'}</pre>
                        </div>
                        <div class="contract-block suggested-block">
                            <h4 class="block-title">
                                <span style="color: black;" data-i18n="suggestions.suggested_content">Suggested Content</span>
                            </h4>
                            <pre>${subRisk.resultContent || 'No suggested content available'}</pre>
                        </div>
                    </div>
                `).join('')}
            `;
        } else {
            document.getElementById('suggestions-tab').innerHTML = `
                <h2 data-i18n="suggestions.title">Suggestions</h2>
                <p data-i18n="suggestions.no_suggestions">No suggested modifications available for this section.</p>
            `;
        }

        // Populate Document Tab
        // Add click handler for the document button
        document.getElementById('viewDocumentBtn')?.addEventListener('click', function() {
            window.location.href = 'document.html';
        });

    }

    // Helper function to get data for the currently active section
    function getActiveSectionData(apiResponse) {
        const activeSectionEl = document.querySelector('.contract-section.active');
        if (activeSectionEl) {
            const activeIndex = parseInt(activeSectionEl.dataset.index, 10);
            return apiResponse[activeIndex];
        }
        return apiResponse[0]; // Default to first
    }

    // Initialize the application when DOM is loaded
    document.addEventListener('DOMContentLoaded', async () => {
        const urlParams = new URLSearchParams(window.location.search);
        const filename = urlParams.get('filename');

        if (!filename) {
            console.error('Filename not found in URL');
            document.getElementById('overview-tab').innerHTML = `
                <div class="content-section">
                    <h3 data-i18n="overview.no_file_specified">No File Specified</h3>
                    <p data-i18n="overview.go_back_and_select">Please go back to your dashboard and select a file to analyze.</p>
                </div>
            `;
            return;
        }

        // Show loading indicator
        document.getElementById('overview-tab').innerHTML = `
            <div class="content-section">
                <h3 data-i18n="overview.loading_analysis">Loading Analysis...</h3>
                <p data-i18n="overview.wait_a_moment">Please wait a moment while we fetch the report.</p>
            </div>
        `;

        try {
            // Convert filename to use .json extension for the report
            const reportFilename = filename.endsWith('.json') ? filename : `${filename.split('.')[0]}.json`;
            const response = await fetch(`/analysis/report/${encodeURIComponent(reportFilename)}`);
            if (!response.ok) {
                const errorData = await response.json().catch(() => ({ detail: 'Failed to fetch analysis report.' }));
                throw new Error(errorData.detail || 'Failed to fetch analysis report');
            }
            
            const sse_messages = await response.json();

            const apiResponse = sse_messages
                .filter(msg => msg && msg.Output && msg.Output.result)
                .map(msg => msg.Output.result);

            if (apiResponse && apiResponse.length > 0) {
                createContractSections(apiResponse);

                const tabButtons = document.querySelectorAll('.tab-btn');
                const tabContents = document.querySelectorAll('.tab-content');

                tabButtons.forEach(button => {
                    button.addEventListener('click', () => {
                        tabButtons.forEach(btn => btn.classList.remove('active'));
                        tabContents.forEach(content => content.classList.remove('active'));

                        button.classList.add('active');
                        const tabId = button.getAttribute('data-tab') + '-tab';
                        document.getElementById(tabId).classList.add('active');

                        if (tabId === 'risks-tab' && window.chartInstance) {
                            window.chartInstance.destroy();
                        }
                        if (tabId === 'risks-tab') {
                            const activeSectionData = getActiveSectionData(apiResponse);
                            const chartConfig = createChartConfig(activeSectionData);
                            const ctx = document.getElementById('riskChart').getContext('2d');
                            window.chartInstance = new Chart(ctx, chartConfig);
                        }
                    });
                });

            } else {
                console.error('apiResponse is not valid or empty after processing SSE messages');
                document.getElementById('overview-tab').innerHTML = `
                    <div class="content-section">
                        <h3 data-i18n="overview.no_contract_data">No Contract Data Available</h3>
                        <p data-i18n="overview.upload_or_check_connection">The analysis report is empty or invalid. Please try uploading and analyzing the contract again.</p>
                    </div>
                `;
            }
        } catch (error) {
            console.error('Error fetching or processing analysis data:', error);
            document.getElementById('overview-tab').innerHTML = `
                <div class="content-section">
                    <h3 data-i18n="overview.error_loading">Error Loading Report</h3>
                    <p>${error.message}</p>
                </div>
            `;
        }

        document.querySelector('.nav-item[href="Analytics_Dashboard"]')?.addEventListener('click', function(e) {
            e.preventDefault();
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            this.classList.add('active');
        });
    });
</script>
</body>
</html>